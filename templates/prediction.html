<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Recommendation | AgroVision</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav class="navbar">
            <a href="{{ url_for('home') }}" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <span>AgroVision</span>
            </a>
            <div class="nav-links">
                <a href="{{ url_for('home') }}">Home</a>
                <a href="{{ url_for('about') }}">How It Works</a>
                <a href="{{ url_for('prediction_page') }}" class="active">Get Recommendation</a>
            </div>
            <button class="mobile-menu">
                <i class="fas fa-bars"></i>
            </button>
        </nav>
    </header>

    <section class="prediction-page">
        <div class="container">
            <div class="section-title">
                <h2>Get Your Crop Recommendation</h2>
                <p>Enter your agricultural parameters to discover the perfect crop for your land</p>
            </div>

            <div class="prediction-layout">
                <!-- Input Section -->
                <div class="input-section">
                    <div class="form-container glow-card">
                        <h3><i class="fas fa-edit"></i> Enter Your Parameters</h3>
                        <form id="predictionForm" method="POST" action="{{ url_for('predict') }}">
                            <div class="form-grid">
                                <!-- Row 1 - Nutrients -->
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="nitrogen">
                                            <i class="fas fa-flask"></i>
                                            Nitrogen (N)
                                        </label>
                                        <input type="number" id="nitrogen" name="nitrogen" min="0" max="200" required 
                                               placeholder="0-200 ppm">
                                        <small>Essential for leaf growth</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="phosphorus">
                                            <i class="fas fa-flask"></i>
                                            Phosphorus (P)
                                        </label>
                                        <input type="number" id="phosphorus" name="phosphorus" min="0" max="200" required 
                                               placeholder="0-200 ppm">
                                        <small>Root development</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="potassium">
                                            <i class="fas fa-flask"></i>
                                            Potassium (K)
                                        </label>
                                        <input type="number" id="potassium" name="potassium" min="0" max="200" required 
                                               placeholder="0-200 ppm">
                                        <small>Water regulation</small>
                                    </div>
                                </div>

                                <!-- Row 2 - Climate -->
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="temperature">
                                            <i class="fas fa-thermometer-half"></i>
                                            Temperature
                                        </label>
                                        <input type="number" step="0.1" id="temperature" name="temperature" required 
                                               placeholder="Â°C">
                                        <small>Average temperature</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="humidity">
                                            <i class="fas fa-tint"></i>
                                            Humidity
                                        </label>
                                        <input type="number" step="0.1" id="humidity" name="humidity" min="0" max="100" required 
                                               placeholder="0-100%">
                                        <small>Relative humidity</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="ph">
                                            <i class="fas fa-vial"></i>
                                            pH Level
                                        </label>
                                        <input type="number" step="0.1" id="ph" name="ph" min="0" max="14" required 
                                               placeholder="0-14">
                                        <small>Soil acidity</small>
                                    </div>
                                </div>

                                <!-- Row 3 - Rainfall -->
                                <div class="form-row">
                                    <div class="form-group full-width">
                                        <label for="rainfall">
                                            <i class="fas fa-cloud-rain"></i>
                                            Rainfall
                                        </label>
                                        <input type="number" step="0.1" id="rainfall" name="rainfall" min="0" required 
                                               placeholder="mm">
                                        <small>Annual rainfall in millimeters</small>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="submit-btn glow-button">
                                <i class="fas fa-calculator"></i>
                                Analyze & Get Recommendation
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="output-section">
                    <div class="result-container glow-card">
                        <!-- Loading State -->
                        <div id="loading" class="loading">
                            <div class="spinner"></div>
                            <h3>Analyzing Your Agricultural Data</h3>
                            <p>Our AI is processing your parameters to find the perfect crop match...</p>
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                        </div>

                        <!-- Result Content -->
                        <div id="resultContent" class="result-content">
                            {% if crop_data %}
                                <!-- Success Result -->
                                <div class="result-success">
                                    <div class="success-header">
                                        <i class="fas fa-check-circle"></i>
                                        <h3>Recommendation Ready!</h3>
                                        <p>Based on your input parameters, here's your ideal crop</p>
                                    </div>
                                    
                                    <div class="prediction-result">
                                        <div class="result-label">Recommended Crop</div>
                                        <div class="predicted-crop glow-text">{{ crop_data.name }}</div>
                                        
                                        <!-- ACTUAL CROP IMAGE VISUALIZATION -->
                                        <div class="crop-visual">
                                            <div class="crop-image-container">
                                                {% set image_filename = crop_data.name.lower() + '.jpg' %}
                                                <img src="{{ url_for('static', filename='crops/' + image_filename) }}" 
                                                     alt="{{ crop_data.name }}" 
                                                     class="crop-image"
                                                     onerror="this.style.display='none'; document.getElementById('crop-icon-fallback').style.display='flex';">
                                                
                                                <!-- Fallback icon if image doesn't exist -->
                                                <div id="crop-icon-fallback" class="crop-icon-large" style="display: none;">
                                                    {% if crop_data.name == 'Rice' %}
                                                    <i class="fas fa-tint"></i>
                                                    {% elif crop_data.name == 'Maize' %}
                                                    <i class="fas fa-seedling"></i>
                                                    {% elif crop_data.name == 'Cotton' %}
                                                    <i class="fas fa-cloud"></i>
                                                    {% elif crop_data.name == 'Coffee' %}
                                                    <i class="fas fa-mug-hot"></i>
                                                    {% elif crop_data.name in ['Wheat', 'Barley'] %}
                                                    <i class="fas fa-wheat"></i>
                                                    {% elif crop_data.name in ['Banana', 'Mango', 'Apple', 'Orange'] %}
                                                    <i class="fas fa-apple-alt"></i>
                                                    {% elif crop_data.name in ['Grapes'] %}
                                                    <i class="fas fa-wine-bottle"></i>
                                                    {% elif crop_data.name in ['Coconut'] %}
                                                    <i class="fas fa-tree"></i>
                                                    {% elif crop_data.name in ['Chickpea', 'Lentil', 'Kidneybeans'] %}
                                                    <i class="fas fa-seedling"></i>
                                                    {% else %}
                                                    <i class="fas fa-leaf"></i>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="crop-name-display">{{ crop_data.name }}</div>
                                            <div class="crop-badge">AI Recommended</div>
                                            
                                            <div class="crop-background 
                                                {% if crop_data.name in ['Rice', 'Wheat', 'Maize'] %}crop-cereal
                                                {% elif crop_data.name in ['Cotton', 'Jute'] %}crop-fiber
                                                {% elif crop_data.name in ['Coffee', 'Tea'] %}crop-beverage
                                                {% elif crop_data.name in ['Banana', 'Mango', 'Apple', 'Orange'] %}crop-fruit
                                                {% elif crop_data.name in ['Chickpea', 'Lentil', 'Kidneybeans'] %}crop-pulse
                                                {% else %}crop-other{% endif %}">
                                            </div>
                                        </div>

                                        <!-- Crop Insights -->
                                        <div class="crop-insights">
                                            <h4><i class="fas fa-info-circle"></i> Growing Insights</h4>
                                            <div class="insights-grid">
                                                <div class="insight-card">
                                                    <i class="fas fa-calendar"></i>
                                                    <div>
                                                        <strong>Season</strong>
                                                        <span>{{ crop_data.season }}</span>
                                                    </div>
                                                </div>
                                                <div class="insight-card">
                                                    <i class="fas fa-mountain"></i>
                                                    <div>
                                                        <strong>Soil Type</strong>
                                                        <span>{{ crop_data.soil }}</span>
                                                    </div>
                                                </div>
                                                <div class="insight-card">
                                                    <i class="fas fa-thermometer-three-quarters"></i>
                                                    <div>
                                                        <strong>Temperature</strong>
                                                        <span>{{ crop_data.temperature }}</span>
                                                    </div>
                                                </div>
                                                <div class="insight-card">
                                                    <i class="fas fa-cloud-rain"></i>
                                                    <div>
                                                        <strong>Rainfall</strong>
                                                        <span>{{ crop_data.rainfall }}</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Growing Tips -->
                                            <div class="growing-tips">
                                                <h5><i class="fas fa-lightbulb"></i> Key Growing Tips</h5>
                                                <ul>
                                                    {% for insight in crop_data.insights %}
                                                    <li>{{ insight }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="action-buttons">
                                        <button onclick="resetForm()" class="action-btn secondary">
                                            <i class="fas fa-redo"></i>
                                            Analyze Again
                                        </button>
                                        <a href="{{ url_for('home') }}" class="action-btn primary">
                                            <i class="fas fa-home"></i>
                                            Back to Home
                                        </a>
                                    </div>
                                </div>
                            {% else %}
                                <!-- Welcome State -->
                                <div class="welcome-state">
                                    <div class="welcome-icon">
                                        <i class="fas fa-seedling"></i>
                                    </div>
                                    <h3>Ready to Discover Your Perfect Crop?</h3>
                                    <p>Fill in the agricultural parameters on the left to get your personalized crop recommendation. Our AI will analyze your data and suggest the best crop for your specific conditions.</p>
                                    
                                    <div class="info-tips">
                                        <div class="tip-card">
                                            <i class="fas fa-lightbulb"></i>
                                            <div>
                                                <h4>Accurate Data</h4>
                                                <p>Use recent soil test results for best accuracy</p>
                                            </div>
                                        </div>
                                        <div class="tip-card">
                                            <i class="fas fa-clock"></i>
                                            <div>
                                                <h4>Quick Results</h4>
                                                <p>Get recommendations within seconds</p>
                                            </div>
                                        </div>
                                        <div class="tip-card">
                                            <i class="fas fa-chart-line"></i>
                                            <div>
                                                <h4>Data-Driven</h4>
                                                <p>Based on thousands of successful patterns</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <a href="{{ url_for('home') }}" class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <span>AgroVision</span>
                    </a>
                    <p>Transforming agriculture through AI-powered insights.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="{{ url_for('home') }}">Home</a>
                    <a href="{{ url_for('about') }}">How It Works</a>
                    <a href="{{ url_for('prediction_page') }}">Get Recommendation</a>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 AgroVision. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Form submission with 3-second loading animation
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading animation
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('resultContent').style.display = 'none';
            
            // Simulate progress bar
            const progressFill = document.querySelector('.progress-fill');
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                    // Submit form after 3 seconds
                    setTimeout(() => {
                        document.getElementById('predictionForm').submit();
                    }, 500);
                } else {
                    width++;
                    progressFill.style.width = width + '%';
                }
            }, 30); // 3 seconds total
            
            // Disable form resubmission
            this.querySelector('button[type="submit"]').disabled = true;
        });
        
        // Reset form function
        function resetForm() {
            document.getElementById('predictionForm').reset();
            document.getElementById('loading').style.display = 'none';
            document.getElementById('resultContent').style.display = 'block';
            document.querySelector('button[type="submit"]').disabled = false;
            
            // Scroll to top smoothly
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Show result if crop_data exists (after form submission)
        window.onload = function() {
            {% if crop_data %}
                document.getElementById('loading').style.display = 'none';
                document.getElementById('resultContent').style.display = 'block';
                
                // Scroll to result smoothly
                setTimeout(() => {
                    document.getElementById('resultContent').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 300);
            {% endif %}
        };
    </script>
</body>
</html>